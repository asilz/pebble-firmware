def configure(conf):
    conf.env.append_unique('DEFINES', 'NRF54L15_XXAA')
    conf.env.append_unique('DEFINES', 'NRF_CONFIG_NFCT_PINS_AS_GPIOS')
    conf.env.append_unique('DEFINES', 'NRF_APPLICATION')
    #conf.env.append_unique('DEFINES', 'NRFX_QSPI_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_SPIM_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_SPIM30_ENABLED=1')
    #conf.env.append_unique('DEFINES', 'NRFX_TWI_ENABLED=1')
    #conf.env.append_unique('DEFINES', 'NRFX_TWI10_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_UARTE_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_UARTE00_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_DPPI00_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_DPPI10_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_DPPI20_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_DPPI30_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB00_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB10_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB01_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB20_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB11_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB21_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB22_ENABLED=1')
    conf.env.append_unique('DEFINES', 'NRFX_PPIB30_ENABLED=1')
    

def build(bld):
    bld.recurse('../../../../third_party/cmsis_core')

    micro_sources = bld.path.parent.parent.parent.parent.ant_glob(f'third_party/hal_nordic/nrfx/**/*.c', excl = ['**/system_nrf*.c', '**/startup_nrf_common.c', '**/nrfx_twi_twim.c'])

    nrfx_basedir = "../../../../third_party/hal_nordic"
    
    micro_sources += [ f"{nrfx_basedir}/nrfx/mdk/system_nrf54l.c" ]
    micro_sources += [ f"{nrfx_basedir}/nrfx/mdk/gcc_startup_nrf54l15_application.S" ]

    micro_includes = [
        nrfx_basedir,
        f'{nrfx_basedir}/nrfx',
        f'{nrfx_basedir}/nrfx/hal',
        f'{nrfx_basedir}/nrfx/mdk',
        f'{nrfx_basedir}/nrfx/drivers/include',
        f'{nrfx_basedir}/nrfx/templates',
    ]

    # micro_includes += ['../../src/fw/board/boards/board_asterix']

    bld.stlib(source=micro_sources,
              target='hal_nordic',
              use=['cmsis_core'],
              includes=micro_includes,
              export_includes=micro_includes)

# vim:filetype=python
